[На главную](../../index.md)

# Новое  в версии. Релиз 243 от 29.10.2021

**Условные обозначения:**
 >[номер] - номер заявки во внутренней системе учета заявок компании "БУХта".

#### Содержание: 

- Зарплата
- Отчеты
- Настройка генерации проводок

## Добавление новой возможности

#### 24551
В станадртной карточке ГТД, если не заполнено поле __Номер__, при изменении поля __Номер партии__, он сохраняется в поле __Номер__. При этом поле __Номер__ длиной 30, а поле __Номер партии__ - 200. 
>Теперь в поле __Номер__ записываются __первые 30 символов__ поля __Номер партии__.

## Усовершенствование

#### 24460
Доработан режим работы с таблицей __Коды табеля__. 
До этого релиза таблица каждый раз перезаписывалась при синхронизации новым релизом.
Добавлять отличные от стандартных кодов и удалять коды было запрещено.
Теперь можно добавлять и редактировать коды табеля с кодом > 1000 и цифровым кодом > 100.
Добавлять и редактировать коды табеля можно ТОЛЬКО в меню __Кадры-Насторйка-Коды табеля__, удалять коды из таблицы по прежнему нельзя.
При синхронизации таблица __Коды табеля__ не заполняется заново, если все стандартные коды в ней присутствуют.
В карточке редактирования Кода табеля, если код табеля>1000, то поля Буква, Дата и Название открыты для редактирования, при добавлении Кода табеля автоматически заполняются поля Код табеля - следующим значением после последнего кода в таблице, большем 1000, и Цифра - следующим значением после последнего в таблице, большем 100.

#### 24548
Доработан режим расчета среднего (форма __З/П расчет среднего заработка__): теперь в режим можно передавать параметр из вызывающей его формы - ключ таблицы __Сотрудник__ или таблицы __ЗП статус__.
И тогда на экране режима расчета среднего будет автоматически заполнены соответствующие поля.
- Если передан ключ сотрудника - будет заполнено только поле Сотрудник.
- Если передан ключ таблицы __ЗП статус__ - будут заполнены поля Сотрудник, Даты начала и конца, кол-во дней, тип расчета:
- для статуса Очередной отпуск - отпуск,
- для статуса Больничный лист - больничный-Простое заболевание
- для статуса По беременности и родам - больничный-По беременности и родам
- для статуса Отпуск по уходу за ребенком - больничный-Отпуск по уходу 30.4
- для остальных - средний
>При этом в записи таблицы __ЗП статус__ должны быть заполнены поля Дата, дата конца, кол-во дней, иначе в режиме расчета среднего автоматически будет заполнено только поле Сотрудник из переданного ЗП Статуса.

Таким образом, перед вызовом формы расчета среднего из другой пользовательской формы, следует заполнить два параметра: 
- __ZpSred_Table_Name__ (принимает значения 'ЗПСТАТУС' или 'СОТРУДНИК' - указывает, ключ какой таблица мы передаем) 
- __ZpSred_Table_ID__ - значение ключа таблицы __Сотрудник__ или таблицы __ЗП статус__. 
>Следует __ОБЯЗАТЕЛЬНО__ обнулить эти параметры в вызывающей форме после возврата из формы __З/П расчет среднего заработка__.

#### 24553
Доработан режим выгрузки из БУХты файла с ЭЛН в форматах Реестра и ЭЛН (форма __З/П. Экспорт ЭЛН в  XML__).
До этого в тэг ```returnDateEmpl``` выгружалась дата из карточки ЭЛН - из поля __Дата начала работы__ с закладки _Расчет_ (заполняется работодателем)", а НЕ из поля __Приступить к работе__ с закладки _Периоды ЛН_.
>Теперь, если поле __Дата начала работы__ в ЭЛН не заполнено, то  в тэг ```returnDateEmpl``` выгружается дата из поля __Приступить к работе__.

#### 24559
Доработан алгоритм выгрузки формы СЗВ-ТД __Сведения о трудовой деятельности работников__ (выгружается и печатается из формы __Кадры. СЗВ-ТД по списку трудовых книжек__ по __ALT-T__ по списку записей из _Трудовых книжек_).
>При отмене кадрового мероприятия в файле СЗВ-ТД нужно указывать __UUID (уникальный идентификатор)__ отменяемого мероприятия.

В связи с этим, добавлено поле __ИдентификаторUUID__ в таблицу __Кадры Трудовая книжка__, поле заполняется значением функции __NewID()__ при добавлении записи в таблицу.
>При выгрузке в файл СЗВ-ТД, если заполнено поле __ИдентификаторUUID__, то в тэг ```UUID``` выгружается его значение, если нет - то как и раньше результат функции __NewID()__.

#### 24560
Доработан режим загрузки файла с ЭЛН нетривиальной структуры (по уходу за ребенком до 8 лет) в форму расчета пособия по нетрудоспособности (форма __З/П расчет среднего заработка__), а также сохранение данных из такого ЭЛН в Реестр в таблицу ___ЗП ЭЛН__ в БУХту и в ```xml-файл.```

## Информация для разработчиков

Пример заполнения параметров и вызова формы __З/П расчет среднего заработка__ из другой формы:
```delphi
// передаем в форму расчета среднего название таблицы ЗПСТАТУС и ключ таблицы [ЗП статус]
// будут заполнены поля Сотрудник, Даты начала и конца, кол-во дней, тип расчета:
// - для статуса Очередной отпуск - отпуск,
// - для статуса Больничный лист - больничный-Простое заболевание
// - для статуса По беременности и родам - больничный-По беременности и родам
// - для статуса Отпуск по уходу за ребенком - больничный-Отпуск по уходу 30.4
// - для остальных - средний
// в Статусе ЗП должны быть заполнены поля Дата, дата конца, кол-во дней
  Self.Param.Value('ZpSred_Table_Name') := 'ЗПСТАТУС';
  Self.Param.Value('ZpSred_Table_ID') := StatusID;
  ShowForm('З/П расчет среднего заработка',Self);
  Self.Param.Value('ZpSred_Table_Name') := '';
  Self.Param.Value('ZpSred_Table_ID') := 0;
// или передаем в форму расчета среднего название таблицы СОТРУДНИК и ключ таблицы [Сотрудник] - будет заполнено только поле Сотрудник
  Self.Param.Value('ZpSred_Table_Name') := 'СОТРУДНИК';
  Self.Param.Value('ZpSred_Table_ID') := SotrId;
  ShowForm('З/П расчет среднего заработка',Self);
  Self.Param.Value('ZpSred_Table_Name') := '';
  Self.Param.Value('ZpSred_Table_ID') := 0;
  ```

[подробнее о конфигурации зарплата](Стандартная_Зарплата.htm)

>[скачать версию **Buhta20211029.zip**](Buhta20211029.zip)
